## 拥塞基本定义
### 拥塞的情况
![输入图片说明](/imgs/2025-09-18/BBudinJn2s2Lz8Eg.png)总结
拥塞是不可避免的，流量控制是解决拥塞的关键
### 公平性有利于设计拥塞控制
![输入图片说明](/imgs/2025-09-18/Dphl7bM1AsV9ma65.png)示意图

方案一保证了吞吐量，但是方案二在第二条链路上保证了公平性，设计拥塞时要提前达成公平性

![输入图片说明](/imgs/2025-09-18/7uSqvVPRANRCjw1L.png)常用的公平方法——最大最小原则

简单来说就是将最大流最小化，即不能通过减小一个小流的速率来增大一个比他大的流的速率，本质上为共享一个链路的瓶颈，上述情况的方案二就是在最大最小原则下的速率分配情况

![输入图片说明](/imgs/2025-09-18/oyHfz87EVB0Hbnda.png)以单链路为例的一个分配例子

先根据输入链路数量与输出链路速率平均分配，然后从速率最小的输入链路开始，如果其速率小于分配速率，则只分配给其对应的速率，剩下的速率再平分给剩下的链路，然后再考虑次小，如果超过了分配的速率，则只分配给其平均速率，以此类推

### 阻塞控制的目标
1. 实现高吞吐量
2. 实现公平性，通过最大最小原则实现
3. 实现对网络情况的快速反应
4. 实现分布式控制

## 拥塞控制基本方法

### 基于网络的流量控制
需要注意的一点是之前提到过的（加权）公平队列确实可以控制每个链路对应的发送速率，但是不能反馈到输入链路的源以控制他们该以什么速率来发送数据，因此实现拥塞控制时需要来自路由器的显示反馈用于指示网络中的拥塞。通常可以将网络中拥塞的情况如输出链路的剩余流量大小、丢包情况等，通过搭乘要到达某一端点的包来反馈到该端点，端主机可以自由的决定如何处理网络中存在拥塞的情况，如减小流量、实行最大最小公平性等
![输入图片说明](/imgs/2025-09-18/lXjFm32AtS0C8wXv.png)示意图

### 基于端主机的流量控制
设想为通过观察网络的行为，由此来决定发送数据的速率。这一方法的优势在于如果不依赖于路由器的行为，或者不依赖于路由器发送回特定的消息，则端主机可以在不更改网络的情况下随着时间的推移而演化和适应它。一个实际的例子就是TCP，它通过观察网路的行为，完全在端主机上实现拥塞控制。如果一个包丢失了，则端主机可以通过超时或者看到一系列相同的确认信息来判断，从而减小速率来控制拥塞。TCP之所以采取这种方式的还有一个原因是IP本身不提供网络中拥塞情况的反馈，TCP是在IP基础上的，因此采用基于端主机的方式来进行流量控制

![输入图片说明](/imgs/2025-09-18/sQSkXkcJpX3SqLwg.png)示意图

![输入图片说明](/imgs/2025-09-18/OxrrvuNpKxUVhk4h.png)TCP控制概述

![输入图片说明](/imgs/2025-09-18/wy0c0UGYraJvSKSx.png)图中展示的两种情况，一是往返时间大于窗口大小的情况，二是往返时间等于窗口大小的情况，第二种情况下对网络的利用效率更高

![输入图片说明](/imgs/2025-09-18/3Wa5R2qx5uRBgnEj.png)TCP协议会在发送方考虑滑动窗口的大小，在网络通畅时，会用接收端反馈的窗口大小，而在网络拥塞时，则会在发送端计算cwnd的大小，将其作为窗口大小

![输入图片说明](/imgs/2025-09-18/FlVfQjMPgAzpcyKv.png)计算cwnd的方法为AIMD，即线性增大、乘性减小，每有一个包顺利收到则cwnd大小增加窗口大小的倒数，否则若丢包则将窗口大小减半，因此若一窗口顺利发送则会为窗口增加1的大小（W个包），否则就将窗口大小减半。下图是示意图，这一曲线也被称作TCP（AIMD）锯齿波，绿色的曲线是放大后的图像，实际上是每过一个RTT（包确认往返时间）cwnd才增大1

![输入图片说明](/imgs/2025-09-18/THvsV0IXLn0onPA5.png)Summary

## 单数据流中的AIMD控制
![输入图片说明](/imgs/2025-09-18/kCrWW4HVDh242WGQ.png)示意图
在缓冲区放不下输入链路来的数据包后，会出现丢包，并将该标记附加在缓冲区队列中的最后一个包，等该包到达目的地后目的地会返回丢包信号，发送端收到该信号后就会按照AIMD减小一半的窗口大小，同时停止发送，停止发送与恢复的情况如下图

![输入图片说明](/imgs/2025-09-18/RzpOVbn3pXKLVoch.png)两种方法发送端来判断是否丢包，并做出不同的处理

![输入图片说明](/imgs/2025-09-18/pGflQrtdiZ6vovu5.png)示意图三张图有四张曲线，分别表示了cwnd的大小、往返时间（由于有包在缓冲区中而变大）、瓶颈链路利用率、缓冲区占用率
由图可以看出在AIMD的作用下链路始终保持繁忙，提高了利用效率

![输入图片说明](/imgs/2025-09-18/2CmyEISRX8kOFyGa.png)单流下的速率计算，可以简单的定义为一个窗口所发送出的字节数除以往返时间，因此其实最终结果是一个常数，窗口本质上做的就是探索袋子有多大，我们可以将多少字节放入网络而不溢出

![输入图片说明](/imgs/2025-09-18/TZgmALuVWJGJFbct.png)关于缓冲区的大小，最理想的情况是其大小等于往返时间乘上链路输出的速率，如果小于该大小，则会导致在发生减半后的一小段时间内链路的利用率降低

### 示例
![输入图片说明](/imgs/2025-09-18/WrlvUS8S7f09mB2M.png)![输入图片说明](/imgs/2025-09-18/GMQHddXR58P1pA4S.png)![输入图片说明](/imgs/2025-09-18/E6hKEnx1cyOn3UoO.png)![输入图片说明](/imgs/2025-09-18/vW35pxbeFdIC3Rzz.png)
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTkxMTExMTIxNiwtMTI4MTg1NDQxMywxNz
c5NjgxNTkyLDEyNTM1OTc5NzQsLTczMDgyMzYzNiwtMzM2MDA0
NDgyLC03NzIxMTU5MjksLTEwODIxMjE1MjYsNTA0NDQyMTM4LD
czODIzMTIwMiwtMTcyOTI2MzU4NCwtMTc1MjY4MzYyOCwtMTEx
NTcxMjcxNywtMTQzMTczNDY1OSwxMzM3ODE4ODg4XX0=
-->