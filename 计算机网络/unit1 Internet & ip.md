## 互联网（Internet）
network application
最常用的通信模型是双向可靠的字节流，即两台主机间在建立链接后双向的、可靠的对字节流的读写
eg1：万维网
其使用了http的超文本传输通信协议，内容均为ASCII文本。客户端发送一个对网页的请求get，请求其根页面，服务器接收到请求后会检测其是否有效，并返回响应，响应中包含一个数字代码，表示响应的结果
![示意图](/imgs/2025-06-28/lTwR2uCad48xJq7N.png)示意图
eg2：bit torrent
一款允许人们交换大型文件的程序，客户端从其他客户端请求文档单个客户端可以并行的从其他客户端请求文档，为了实现这一点，bit torrent会将文档切成片，一个客户端从另一个客户端下载片后，会告诉其他客户端他拥有该片，从而其他客户端可以请求该片，这些合作的客户端称为群。客户端想下载文档时，需要找到一个“种子文件”，通过万维网找到并通过http下载，该种子包含了对应文件的一些信息，还告诉bit torrent该种子的trace是谁，trace是一个节点，跟踪哪些客户端是群的成员，为了加入种子，客户端通过http和trace联系，请求客户端列表，并与需要的客户端建立链接下载文件，这些客户端可以反过来下载其拥有的文件![输入图片说明](/imgs/2025-06-28/EDjLhI0IqyHiKTZl.png)示意图
eg3：Skype
一个视频通话程序。一般情况下，两个客户端直接建立链接通信而非从专用服务器请求，如下图![输入图片说明](/imgs/2025-06-28/zh2B4EbJclsz06Kl.png)情况一

如果一个客户端使用了nat（网络地址转换），客户端可以通过nat轻松的与外界建立链接，但是外界与nat后面的客户端建立链接较为困难，AB链接的建立通过Rendezvous实现，启动时B和R建立双向链接，A要发起对B的请求时，先通过R发送请求，如果B接受，则会发送一个到A的请求，从而建立双向链接，这被称为反向链接，因为其颠倒了启动链接的预期方向![输入图片说明](/imgs/2025-06-28/RbIt6jx7ruIfpcu7.png)情况二

如果两个客户端都在nat后面，则使用另一个中继服务器Relay，此时AB的通信都通过R进行
![输入图片说明](/imgs/2025-06-28/gWSBUO9xmsyjRgvR.png)情况三

## What internet is?
Internet通过四大基本层实现，自顶向下为：应用层，传输层，网络层，链接层。其中传输层和网络层是本课程的重点。网络通信过程中，每一层表现上只与另一端的相同层通信，而不考虑其底层的行为。![输入图片说明](/imgs/2025-06-28/K73I51roUpjp1YVx.png)四层及其基本作用
![输入图片说明](/imgs/2025-06-28/vwJAPyZSraEVCbYW.png)ip的重要性
![输入图片说明](/imgs/2025-06-28/e0c8PKplYmKJXbQf.png)不同时期定义的层的对应关系

### 网络层
网络层使用ip协议，ip有两个特征：
1. 尽力将数据报传送到另一端，但不保证
2. 不保证数据报的完整性、顺序性

ip协议有四个属性：
1. 通过互联网逐跳发送数据报从端到端
4. 不可靠性
5. 尽可能做最好，数据报仅在必要时丢弃
6. 没有每流状态，协议无链接

ip协议简单的原因：更快，效率更高，成本更低，保持端到端原则，允许高层定义基于其的协议，对底层做更少假设

ip服务的五个模型：
1. 防止数据报循环，通过在报头中加入计数器实现，路由遇到计数器为0的数据报时会将其丢弃，否则在经过时将其减一
2. 根据链路允许的大小将数据报切片，会在表头记录切片的前后关系顺序
3. 通过报头校验和来减少传递到错误目标的可能性
4. 允许ip版本的更新，如IPv4到IPv6
5. 允许在报头中添加新字段
![输入图片说明](/imgs/2025-06-28/0iEQHWU2wAumbq0Z.png)IPv4的数据报

如上图，从上到下从左到右分别为：
version：ip版本
header length：报头长
type of service：向路由器提供关于此报的重要提示
total packet length：总报长
packet id、flags、fragment offset：被切片后的相关信息
ttl：该报存活时间，计数器，用于防止数据报循环
protocol id：传输层协议
checksum：计算校验和，防止报头损坏下传输到错误地址
sia：数据报源ip地址
dia：数据报汇ip地址

### 传输层
传输层的工作是运行一个在网络层之上的协议，处理传输过程中丢包等问题，常见的如tcp/ip协议和udp协议等
TCP：
tcp byte stream：典型操作中存在客户端与服务器，服务器监听请求，客户端发出链接请求，服务器给出响应，交换需要三个消息，即三次握手
第一步客户端发送同步请求信息SYN
第二步服务器返回确认同步SYN-ACK
第三步客户端返回确认ACK
![输入图片说明](/imgs/2025-06-28/SQ86TI8MgOOrxaJR.png)示意图

要打开到另一个程序的tcp流，需要两个地址
第一个是ip地址，网络层凭此将数据报发送到计算机地址
第二个是tcp端口，告诉计算机软件将数据传送到哪个应用程序
web服务器通常运行在tcp80端口
从客户端到服务器的过程中通过路由器逐跳传输，路由器有许多链接其的链路，数据报到达时，路由器会决定将其发送到哪个链路上，路由器自身也有ip地址，因此其可能不传输数据报，而是传递给自己的软件。路由器通过转发表决定行为，数据报到达时，路由器会检查哪个转发表条目模式最匹配该报，转发对应链路
### 分组交换思想（packet switching）
分组交换思想是将数据分解成离散的，自包含的数据块，每个数据块称为数据包，包含足够的信息使网络能将其传送到目的地。每个数据包是独立的，到达路由时根据链路空闲与否进行转发与等待
网络层转发的一种方法是源路由，但存在重大安全问题，一个优化是在每一个交换机中放置少量状态，告诉数据报目的地和下一跳地址
分组交换的两个好处：
1. 交换机可以对数据包进行独立的本地决策，使交换机更简单
2. 可以让交换机高效的共享多个用户之间的链路，允许共享链路的多个流之间共享容量

流：流是属于同一个端到端的一组数据报，如tcp链接
交换机为了效率，不对数据报添加或移除每流状态，也不存储，对每个数据报独立决策
数据的传输是猝发的，分组交换允许链路的共享，如同一路由器下ab两个端，允许a空闲时b使用链路的所有资源，或者二者共用时分享链路，这种单个资源以概率或统计的方式跨多用户共享称为统计复用
分层
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTQwMTEzMTExMiwxOTc3NjQyMjE0LDgxNj
c3MDUyMiw1Mjg1MzA3NzUsLTk1ODg5MDYzLC02ODAwNTE4Mzhd
fQ==
-->